// ??????, ????????? ????????? ??? ???????
//$(document).ready(function(e) {

    // ????? ????????? ??? ????????? 
    commonPaginationConfig = {
        'ClickablePagesCount':5,
        // ?????????? ?????? ?? ????????, ??????? ???????????
        //   ????? ???? ???????? ? ?????? ?????????
    
        'RowsPerPage':15, // ?????????? ??????? ?? ????? ???????? ??????

    }

    PaginationSettingsContainer =
    {
       
    }

    // ????????????? ?????? ??? ?????????? ??????????
    // TableListId - ID ??????? ?? ???????
    // SortName - ????, ?? ???????? ??? ??????????
    //  SortOrder - ??????? ??????????
    //  OnPaginationChange - ??????? ?????????? ??????. ???????, ????? ???
    //    ??????? ?? ?????? ????????? ????? ???? ??????? ???????????? ??????
    function InitPaginationList(TableListId, SortName,SortOrder,OnPaginationChange)
    {
        PaginationSettingsContainer[TableListId] =
        {
            'sortOrder': SortOrder,
            'sortName': SortName,
            'paginationChangeHandler': OnPaginationChange,
            'activePage': 1,
        };
     
        
    }

    //  ?? ?????????????? ?????? ?????????? ????????? ??? ????????? ? ???? ?????? ??? ??????? ? ????
    function getPaginationParameters(ListSelector)
    {
        var PaginationObject = PaginationSettingsContainer[ListSelector];
        var Result = '';
        if (PaginationObject!=undefined) {
            Result = Result+
                'rows='+ commonPaginationConfig.RowsPerPage+
                '&page='+PaginationObject.activePage+
                '&sidx='+PaginationObject.sortName+
                '&sord='+PaginationObject.sortOrder
            ;
        }
        return Result;
    }

    // ????????? ??????? ?? ???????? ??? ??????? ????? ?? ??????
    //   ListId - ??? ?????? ??? ????????
    //   PageNumber - ????? ????????, ?? ??????? ????? ???????
    function goNewPage(ListId,PageNumber)
    {
        // ?????????? ? ???????????? ????????? ????? ????????? ???????? ????????
        PaginationSettingsContainer[ListId].activePage = PageNumber;
        
        // ???????? ??????? "???????? ??????"
        PaginationSettingsContainer[ListId].paginationChangeHandler();
        
        
        
    }

    // ?????????? ?????? ?????? ??? ?????????
    function createEmptyPaginationButton()
    {
        var Result = $('<li>');
        var InnerLink = $('<a>')
        $(InnerLink).attr('href','#');
        $(InnerLink).appendTo(Result);
        
        return Result;
    }

    // ????????? ??????, ?????? ??? ????????? ??????? ??????? ?????????
    function closeTablePage(ListSelector,NewPageNumber, PaginationButton)
    {
        $(PaginationButton).on('click',function(e)
                               {
                                    goNewPage(ListSelector,NewPageNumber);
                                    return false;
                               }
                               
                               );
    }
    
    // ?????? ? ????????? ? ????????? ?????? ?????????
    function createOnePaginationButton(Container,table,ButtonText,PageNumber)
    {
        // ???????? ??????
            var SomeButton = createEmptyPaginationButton();
            $(SomeButton).children('a').text(ButtonText);
            
            // ???????? ?? ??????? ? ????? ????????
            closeTablePage(table,PageNumber,$(SomeButton));
            
            // ????????? ?????? ? ??????
            $(SomeButton).appendTo($(Container));
        
    }

    // ??????? ????????? ? ???????, ??????????? ?? ??????? ?? ????????? Ajax-????????
    // table - ??????? tbody ???????, ?????????? ??????
    //    handler - ??????? ?????? ?????? ??????. ?????????? ??? ??????? ?? ???? ?? ?????? ?????????
    //    totalPagesCount - ????? ?????????? ???????
    //   sortFieldName ? sortOrder - ??????????????? ??????? ??? ?????? ???????
    function printPagination(table, totalPagesCount, paginationContainerSelector)
    {
        var NeedWriteFirstPageButton = true; // ????? ?? ??????? ?????? "???? ?? ?????? ????????"
        var NeedWriteLastPageButton= true; // ????? ?? ??????? ?????? "???? ?? ????????? ????????"
        
        var NeedWriteNextPageButton= true; // ????? ?? ??????? ?????? "???? ?? ????????? ????????"
        var NeedWritePrevPageButton= true; // ????? ?? ??????? ?????? "???? ?? ?????????? ????????"

        var PaginationContainer = null;

        // ???????? ?? ???????? table ??? ????????? ? ??????????, ????????????? ?????? table
        if (paginationContainerSelector == undefined)
        {
            PaginationContainer = $('#'+table+' tbody').parents('div').next().children('ul');
        }
        else
        {
            PaginationContainer = $(paginationContainerSelector).children('ul');
        }
        // ?????? ????????? ????????? ? ?????????? (????? ??? ???? ????????)
        $(PaginationContainer).parent('div').addClass('no-display');
    
        // ??????? ??? ???????? li - ????? ??????? ?? ??????
        $(PaginationContainer).children('li').remove();
    
        // ???? ??????? ?????? ???? - ???????, ????????? ?? ?????
    
        if (totalPagesCount<2) {
            return;
        }
        
        // ?????? ??????? ???????? ?? ????? current-page-number
        var CurrentPageNumber = PaginationSettingsContainer[table].activePage;
        
        // ?????? ????? ??????? ???????? ??? ????????? ? ??????????????? caption-???
        
        // ?????????, ??????? ? ????? ????? ????? ???????? ???????? ????????.
        //      (? ?? ?????)
        var BeginIndex = CurrentPageNumber - Math.floor(commonPaginationConfig.ClickablePagesCount/2);
        var EndIndex = CurrentPageNumber + Math.floor(commonPaginationConfig.ClickablePagesCount/2);
        
        // ???? ????????? ????????????? ????????? ?????? - ???????? ??????? ?????? |BeginIndex|+1
        if (BeginIndex<=0) {
            EndIndex += Math.abs(BeginIndex)+ 1;
            BeginIndex =1;
        }
        
        // ???? ?????? ?????? ????????? ??????, ??? totalPagesCount
        //    - ????? ?? ??????? ?????? ???????, ??? ????? 
        if (EndIndex>totalPagesCount) {
            EndIndex = totalPagesCount;
        }
        
        // ???? ???????? ?????? - ?? ?? ???? ???????? ?????? <<
        if (CurrentPageNumber==1) {
            NeedWriteFirstPageButton = false;
        }
        
        // ???? ???????? - ????????? - ?? ?? ???? ???????? ?????? >>
        if (CurrentPageNumber==totalPagesCount) {
            NeedWriteLastPageButton = false;
        }
        
        
        if (NeedWriteFirstPageButton) {
            // ????????? ? ????????? ?????? <<
            createOnePaginationButton(PaginationContainer,table,'<<',1);
            
            
        }
        
        
        // ??????? ???????? ??????
        for (i=BeginIndex;i<=EndIndex;i++)
        {
            createOnePaginationButton(PaginationContainer,table,i,i);
            
            // ???? i ????? ??????? ???????? ????????
            if (i==CurrentPageNumber) {
                // ?????? ?????????? ???? ?????????? ????? "active"
                $(PaginationContainer).children(':last').addClass('active');
            }
            
        }
        
        if (NeedWriteLastPageButton) {
            // ????????? ? ????????? ?????? >>
            createOnePaginationButton(PaginationContainer,table,'>>',totalPagesCount);
        }
        
        // ??????? ?????????
        $(PaginationContainer).parent('div').removeClass('no-display');
    }
//});